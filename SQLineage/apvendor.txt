ALTER PROCEDURE [dbo].[SP_Eniteo_AP_Vendor_PO] AS


TRUNCATE Table eniteo_bassem.dbo.AP_Vendor_PO

INSERT INTO eniteo_bassem.dbo.AP_Vendor_PO 
       SELECT 
       0 AS ERP_ID,
       company_id AS company_id,
       company_id AS Branch_ID,
       POH_PONumber AS PO_ID,
       POL_LineNum AS PO_Line_ID,
       POH_POHeadID AS ALT_PO_ID,
       POL_POLineID AS ALT_PO_Line_ID,
       POH_VendorID AS Vendor_ID,
       POL_ItemID AS Product_ID,
       NULL AS Product_Group_ID,
       NULL AS Product_Grade_ID,
       NULL AS Ship_Origin_LOC_ID,
       POH_TermsID AS Term_ID,
       POL_UM AS Unit_Of_Measure_ID,
       NULL AS Weight_Unit_Of_Measure_ID,
       NULL AS Freight_Unit_Of_Measure_ID,
       POH_WarehouseID AS Warehouse_ID,
       POL_ShiptoID AS Shipping_Destination_LOC_ID,
       POL_CustomerID AS Customer_ID,
       POH_FOBID AS Free_On_Board_ID,
       POL_InventoryID AS Inventory_ID,
       NULL AS Freight_Vendor_ID,
       NULL AS Buyer_ID,
       NULL AS Receiving_Branch_ID,
       NULL AS Freight_Responsible_ID,
       NULL AS Status_ID,
       NULL AS PO_Line_Status_ID,
       POH_PODate AS Issue_Date,
       NULL AS Entry_Date,
       NULL AS Due_Date,
       NULL AS Completion_Date,
       NULL AS VDA_Date,
       POL_DueDate AS PO_Line_Due_Date,
       NULL AS PO_Line_Original_Due_Date,
       POL_ChangeDt AS PO_Line_Last_Modified_Date,
       NULL AS PO_Line_Ready_Date,
       POL_RollDate AS PO_Line_Roll_Date,
       POH_ShipToType AS Shipping_Destination_Type,
       NULL AS Product_Origin_Type,
       NULL AS Type_Code,
       NULL AS Category_Code,
       NULL AS Category_Description,
       NULL AS Method_Code,
       NULL AS Certificate_Type,
       NULL AS Exchange_Code,
       NULL AS Delivery_Method,
       NULL AS Freight_Exchange_Code,
       NULL AS Product_GA_Type_Code,
       NULL AS Product_Dimension_Format,
       NULL AS Product_Maintenance_Code,
       NULL AS Product_Inquiry_Cost_Code,
       NULL AS Delivered_Flag,
       POL_Received AS Received_Flag,
       POH_NonInvPO AS Non_Inventory_Flag,
       POH_PrintFreight AS Print_Freight_Flag,
       POL_LockActualCost AS Lock_Actual_Cost_Flag,
       POL_GainOverride AS Item_Gain_Override_Flag,
       NULL AS Chemical_Test_Required_Flag,
       NULL AS Physical_Test_Required_Flag,
       NULL AS Certificate_Recieved_Flag,
       NULL AS Acknowledge_Required_Flag,
       NULL AS Part_Flag,
       NULL AS Maintenance_Flag,
       NULL AS Freight_Calculated_Flag,
       NULL AS Completion_Code,
       NULL AS Freight_Responsible_Code,
       NULL AS Updated_Usage_Flag,
       POL_Weight AS Ordered_Weight,
       POL_Pieces AS Ordered_No_of_Pieces,
       POL_Feet AS Ordered_Total_Feet,
       POL_Amount AS Ordered_Total_Cost,
       NULL AS Material_Cost,
       NULL AS Processing_Cost,
       NULL AS Other_Cost,
       NULL AS Freight_Cost,
       NULL AS Balance_Units,
       NULL AS Balance_Measure,
       NULL AS Balance_Weight,
       NULL AS Received_Units,
       NULL AS Received_Measure,
       NULL AS Received_Weight,
       NULL AS Reserved_Units,
       NULL AS Reserved_Quantity,
       NULL AS Reserved_Weight,
       NULL AS Ordered_Measure,
       NULL AS Open_Cost,
       NULL AS Open_Cost_Base_Currency,
       NULL AS Received_Quantity,
       NULL AS Inquiry_Cost,
       POL_Length AS Length,
       POL_Width AS Width,
       POL_Price AS Price,
       POH_Buyer AS Buyer_Name,
       POH_Ship AS Shipping_Method_Description,
       POH_FOBSpecial AS Free_On_Board_Description,
       POL_GainPercent AS Gain_Percent,
       NULL AS No_Of_Lines,
       NULL AS Number_Of_Certificates_By_Shipment,
       NULL AS Number_Of_Certificates_By_Invoice,
       NULL AS Exchange_Rate,
       NULL AS Freight_Rate,
       NULL AS Freight_Exchange_Rate,
       NULL AS Status_Description,
       NULL AS Freight_Responsible_Description,
       NULL AS GA,
       NULL AS Size,
       NULL AS Description_1,
       NULL AS Description_2,
       NULL AS PO_Line_Inquiry_Remark,
       NULL AS PO_Line_Status_Description,
       NULL AS Customer_Part_No,
       POH_Reference AS Reference,
       NULL AS Actual_Received_Cost,
       0 AS Deleted_After_Flag,
       CONVERT(datetime,Getdate(),106) AS ELT_Date
              FROM
       (
              SELECT
              POH.company_id AS company_id,
              POH.POHeadID AS POH_POHeadID,
              POH.PONumber AS POH_PONumber,
              POH.VendorID AS POH_VendorID,
              POH.ShipToID AS POH_ShipToID,
              POH.Buyer AS POH_Buyer,
              POH.PODate AS POH_PODate,
              POH.ReleaseFlag AS POH_ReleaseFlag,
              POH.Ship AS POH_Ship,
              POH.CountryID AS POH_CountryID,
              POH.POComment AS POH_POComment,
              POH.POCommentNP AS POH_POCommentNP,
              POH.FOBID AS POH_FOBID,
              POH.Terms AS POH_Terms,
              POH.Reference AS POH_Reference,
              POH.ShipToName AS POH_ShipToName,
              POH.ShipToAddress AS POH_ShipToAddress,
              POH.ShipToCity AS POH_ShipToCity,
              POH.ShipToState AS POH_ShipToState,
              POH.ShipToZip AS POH_ShipToZip,
              POH.ShipToPhone AS POH_ShipToPhone,
              POH.ShipToFax AS POH_ShipToFax,
              POH.ShipToContact AS POH_ShipToContact,
              POH.ForeignMade AS POH_ForeignMade,
              POH.FOBSpecial AS POH_FOBSpecial,
              CASE WHEN POH.ShipToType = 0 THEN 'company_id Warehouse' ELSE 'Direct to Customer' END  AS POH_ShipToType,
              POH.TermsID AS POH_TermsID,
              POH.FrtCWT AS POH_FrtCWT,
              POH.FrtAmt AS POH_FrtAmt,
              CASE WHEN POH.PrintFreight = 1 THEN 'True' ELSE 'False' END AS POH_PrintFreight,
              POH.RFQNumber AS POH_RFQNumber,
              POH.RFQDate AS POH_RFQDate,
              POH.ProcessingPO AS POH_ProcessingPO,
              POH.WarehouseID AS POH_WarehouseID,
              POH.BlanketPO AS POH_BlanketPO,
              CASE WHEN POH.NonInvPO = 1 THEN 'True' ELSE 'False' END AS POH_NonInvPO,
              POH.FlatFrtAmt AS POH_FlatFrtAmt,
              POH.CountryCode AS POH_CountryCode,
              POH.BatchPrintStatus AS POH_BatchPrintStatus,
              POH.PODueDate AS POH_PODueDate,
              POL.POLineID AS POL_POLineID,
              POL.POHeadID AS POL_POHeadID,
              POL.InventoryID AS POL_InventoryID,
              POL.ItemID AS POL_ItemID,
              POL.ShiptoID AS POL_ShiptoID,
              POL.Pieces AS POL_Pieces,
              POL.Weight AS POL_Weight,
              POL.Feet AS POL_Feet,
              POL.Width AS POL_Width,
              POL.Width1 AS POL_Width1,
              POL.Length AS POL_Length,
              POL.Length1 AS POL_Length1,
              POL.Price AS POL_Price,
              POL.UM AS POL_UM,
              POL.Amount AS POL_Amount,
              POL.Description AS POL_Description,
              POL.MiscINfo AS POL_MiscINfo,
              POL.Flaws00 AS POL_Flaws00,
              POL.Chemistry AS POL_Chemistry,
              POL.VendorTagNum AS POL_VendorTagNum,
              POL.DueDate AS POL_DueDate,
              POL.RollDate AS POL_RollDate,
              POL.ChangeDt AS POL_ChangeDt,
              POL.Release AS POL_Release,
              POL.Comment AS POL_Comment,
              POL.Commentnp AS POL_Commentnp,
              POL.CommentReceiving AS POL_CommentReceiving,
              POL.CommentSales AS POL_CommentSales,
              POL.Paperwrap AS POL_Paperwrap,
              POL.SideUnload AS POL_SideUnload,
              POL.RearUnload AS POL_RearUnload,
              POL.Spacers AS POL_Spacers,
              POL.ForkLift AS POL_ForkLift,
              POL.CountryID AS POL_CountryID,
              POL.LineNum AS POL_LineNum,
              CASE WHEN POL.Received = 1 THEN 'True' ELSE 'False' END AS POL_Received,
              CASE WHEN POL.LockActualCost = 1 THEN 'True' ELSE 'False' END  AS POL_LockActualCost,
              POL.FrtCWT AS POL_FrtCWT,
              POL.FrtAmt AS POL_FrtAmt,
              POL.HideWidthLength AS POL_HideWidthLength,
              POL.DirectBuyout AS POL_DirectBuyout,
              POL.PromiseDate AS POL_PromiseDate,
              POL.FirmDate AS POL_FirmDate,
              POL.Thickness AS POL_Thickness,
              POL.GaugeMin AS POL_GaugeMin,
              POL.GaugeMax AS POL_GaugeMax,
              POL.GainPercent AS POL_GainPercent,
              CASE WHEN POL.GainOverride = 1 THEN 'True' ELSE 'False' END AS POL_GainOverride,
              POL.CustomerID AS POL_CustomerID,
              POL.ClassificationID AS POL_ClassificationID
              FROM
              (SELECT * FROM Eniteo_Bassem.dbo.POHead WHERE last_record_flag = 1 AND Deleted_After = 0) POH 
              LEFT OUTER JOIN
              (SELECT * FROM Eniteo_Bassem.Dbo.POLine WHERE last_record_flag = 1 AND Deleted_After = 0) POL
              ON (POH.POHeadId = POL.POHeadId
              AND POH.company_id = POL.company_id)
       ) a
